<div class="dialog-container">
    <div class="header-section">
      <h2 class="dialog-title">
        <mat-icon>cloud_download</mat-icon>
        Importar Orden desde SILUCIA
      </h2>
      <p class="dialog-subtitle">
        Ingrese el número de orden para obtener los datos desde el sistema SILUCIA
      </p>
    </div>
  
    <div class="content-section">
      <div class="search-header">
        <mat-icon>search</mat-icon>
        <h3>Buscar Orden</h3>
      </div>
      
      <form [formGroup]="orderForm" class="order-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Número de Orden</mat-label>
          <input 
            matInput 
            formControlName="numeroOrden"
            placeholder="Ej: 00401"
            maxlength="5"
          >
          <mat-icon matSuffix>tag</mat-icon>
          <mat-hint>Ingrese el número de orden de 5 dígitos</mat-hint>
          
          <mat-error *ngIf="hasFieldError('numeroOrden')">
            {{ getFieldError('numeroOrden') }}
          </mat-error>
          
          <mat-error *ngIf="numeroOrdenErrors">
            {{ numeroOrdenErrors }}
          </mat-error>
        </mat-form-field>
        
        <div class="form-actions">
          <button 
            mat-raised-button 
            color="primary" 
            type="button"
            (click)="searchOrder()"
            [disabled]="isLoading" 
            class="search-button">
            <mat-icon *ngIf="!isLoading">search</mat-icon>
            <mat-icon *ngIf="isLoading" class="spinning">refresh</mat-icon>
            {{ isLoading ? 'Buscando...' : 'Buscar' }}
          </button>
          
          <button 
            mat-button 
            type="button"
            (click)="clearData()"
            [disabled]="isLoading">
            <mat-icon>clear</mat-icon>
            Limpiar
          </button>
        </div>
      </form>
  
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Buscando orden en SILUCIA...</p>
      </div>
  
      <div *ngIf="showResults && orderData" class="results-section">
        <div class="results-header">
          <mat-icon>assignment</mat-icon>
          <h3>Detalles de la orden para importar</h3>
        </div>
  
        <mat-card class="order-card">
          <mat-card-header>
            <div mat-card-avatar class="order-avatar">
              <mat-icon>description</mat-icon>
            </div>
            <mat-card-title>Orden N° {{ orderData.numero }}/{{ orderData.anio }}</mat-card-title>
            <mat-card-subtitle>SIAF: {{ orderData.siaf }}</mat-card-subtitle>
          </mat-card-header>
  
          <mat-card-content>
            <form [formGroup]="importForm" class="import-form">
              <div class="order-details">
                
                <div class="detail-section">
                  <h4 class="section-title">
                    <mat-icon>assignment</mat-icon>
                    Información de la Orden
                  </h4>
                  <div class="detail-row">
                    <div class="detail-item">
                      <strong>Fecha de Prestación:</strong>
                      <span>{{ formatDate(orderData.fecha_prestacion) }}</span>
                    </div>
                    <div class="detail-item">
                      <strong>Plazo de Prestación:</strong>
                      <span>{{ orderData.plazo_prestacion }} días</span>
                    </div>
                  </div>
                </div>
                <div class="detail-section">
                  <h4 class="section-title">
                    <mat-icon>business</mat-icon>
                    Información del Proveedor
                  </h4>
                  <div class="detail-row">

                    <div class="detail-item">
                      <strong>Ruc Proveedor:</strong>
                      <span>{{ orderData.ruc }}</span>
                    </div>
                    <div class="detail-item">
                      <strong>Razon Social:</strong>
                      <span>{{ orderData.rsocial }}</span>
                    </div>
                  </div>
                </div>

                <div class="detail-section">
                  <h4 class="section-title">
                    <mat-icon>account_tree</mat-icon>
                    Información del Proyecto
                  </h4>
                  <div class="detail-row">
                    <div class="detail-item">
                      <strong>Código de Meta:</strong>
                      <span>{{ orderData.cod_meta }}</span>
                    </div>
                    
                    <div class="detail-item">
                      <strong>Descripción de Meta:</strong>
                      <span>{{ orderData.desmeta }}</span>
                    </div>
                  </div>
                </div>
  
                <div class="detail-section">
                  <h4 class="section-title">
                    <mat-icon>person</mat-icon>
                    Información del Operador
                  </h4>
                  <div class="detail-row">
                    <mat-form-field appearance="outline" class="field-full">
                      <mat-label>Operador</mat-label>
                      <input matInput formControlName="operador">
                      <mat-icon matSuffix>person</mat-icon>
                    </mat-form-field>
                  </div>
                </div>

                <div class="detail-section">
                  <h4 class="section-title">
                    <mat-icon>build</mat-icon>
                    Información de la Maquinaria
                  </h4>
                  
                  <div class="detail-row">
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Tipo de Maquinaria</mat-label>
                      <mat-select formControlName="tipoMaquinaria">
                        <mat-option *ngFor="let option of tipoMaquinariaOptions" [value]="option.value">
                          {{ option.label }}
                        </mat-option>
                      </mat-select>
                      <mat-icon matSuffix>category</mat-icon>
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Máquina/Equipo</mat-label>
                      <input matInput formControlName="maquinaria">
                      <mat-icon matSuffix>precision_manufacturing</mat-icon>
                    </mat-form-field>
                  </div>
  
                  <div class="detail-row">
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Marca</mat-label>
                      <input matInput formControlName="marca">
                      <mat-icon matSuffix>business_center</mat-icon>
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Modelo</mat-label>
                      <input matInput formControlName="modelo">
                      <mat-icon matSuffix>inventory_2</mat-icon>
                    </mat-form-field>
                  </div>
  
                  <div class="detail-row">
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Motor/Capacidad</mat-label>
                      <input matInput formControlName="capacidad">
                      <mat-icon matSuffix>settings</mat-icon>
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline" class="field-small">
                      <mat-label>Año</mat-label>
                      <input matInput formControlName="year">
                      <mat-icon matSuffix>calendar_today</mat-icon>
                    </mat-form-field>
                  </div>
  
                  <div class="detail-row">
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Número de Serie</mat-label>
                      <input matInput formControlName="serie">
                      <mat-icon matSuffix>confirmation_number</mat-icon>
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline" class="field-medium">
                      <mat-label>Placa</mat-label>
                      <input matInput formControlName="placa">
                      <mat-icon matSuffix>local_shipping</mat-icon>
                    </mat-form-field>
                  </div>
                </div>
  
              </div>
            </form>
          </mat-card-content>
  
          <mat-card-actions class="card-actions">
            <button 
              mat-raised-button 
              color="primary"
              (click)="importOrder()"
              [disabled]="isLoading || importForm.invalid">
              <mat-icon>download</mat-icon>
              Importar Orden
            </button>
            <button 
              mat-button
              (click)="clearData()"
              [disabled]="isLoading">
              <mat-icon>refresh</mat-icon>
              Nueva Búsqueda
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>