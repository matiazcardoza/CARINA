<div class="evidence-dialog">
  <!-- Header del diálogo -->
  <div class="dialog-header">
    <h2 mat-dialog-title>Evidencias del Servicio</h2>
    <div class="header-actions">
      <button mat-icon-button (click)="onRefresh()" [disabled]="loading">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-icon-button (click)="onClose()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Contenido del diálogo -->
  <div mat-dialog-content class="dialog-content">
    <!-- Loading spinner -->
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando evidencias...</p>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !loading" class="error-container">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <p>Error al cargar las evidencias</p>
      <button mat-raised-button color="primary" (click)="onRefresh()">
        Reintentar
      </button>
    </div>

    <!-- No evidences found -->
    <div *ngIf="!loading && !error && evidences.length === 0" class="no-evidence-container">
      <mat-icon class="no-evidence-icon">image_not_supported</mat-icon>
      <p>No se encontraron evidencias para este servicio</p>
    </div>

    <!-- Evidences grid -->
    <div *ngIf="!loading && !error && evidences.length > 0" class="evidence-grid">
      <mat-card
        *ngFor="let evidence of evidences; trackBy: trackByEvidenceId"
        class="evidence-card"
        (click)="openImageModal(evidence.evidence_path)">
        <div class="image-container">
          <img
            [src]="getFullImageUrl(evidence.evidence_path)"
            [alt]="'Evidencia ' + evidence.id"
            class="evidence-image"
            loading="lazy"
            >
          <div class="image-overlay">
            <mat-icon>zoom_in</mat-icon>
          </div>
        </div>
        <mat-card-content class="card-content">
          <p class="evidence-info">ID: {{evidence.id}}</p>
          <p class="evidence-info" *ngIf="evidence.created_at">
            {{evidence.created_at | date:'dd/MM/yyyy HH:mm'}}
          </p>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Modal para imagen ampliada -->
  <div *ngIf="selectedImage" class="image-modal" (click)="closeImageModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <button mat-icon-button (click)="closeImageModal()" class="close-button">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <img [src]="getFullImageUrl(selectedImage)" class="modal-image" alt="Evidencia ampliada">
    </div>
  </div>

  <!-- Actions -->
  <div mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="onClose()">Cerrar</button>
  </div>
</div>
