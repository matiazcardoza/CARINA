<p-toast />

<div class="card" style="padding: 1rem;">

  <div class="flex items-center justify-between mb-3" style=" padding: 1rem 0;">

    <div>
      <h1 class="text-2xl font-semibold">Obras</h1>
      <p class="text-gray-500">Importa usuarios desde Silucia por obra.</p>
    </div>

    <div class="flex gap-2" style="display: flex; justify-content: end; gap: 0.5rem;">
      <!-- <input pInputText [(ngModel)]="filtro()" placeholder="Buscar..." (keyup.enter)="onSearch()" /> -->
      <input pInputText 
       [ngModel]="filtro()" 
       (ngModelChange)="filtro.set($event)" 
       placeholder="Buscar..." 
      />

      <button 
        pButton 
        class="custom-button" 
        (click)="onSearch()"
      >
        <span pButtonLabel>Buscar</span>
        <i class="pi pi-search" pButtonIcon></i>
      </button>

      <button 
        pButton
        (click)="getObras()"
      >
        <span pButtonLabel>Importar Meta/Obra</span>
        <i class="pi pi-plus" pButtonIcon></i>
      </button>

    </div>

  </div>
<!-- <ng-template style="padding: 1rem;"> -->
  <div style="padding: 1rem; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem;">
    <p-table
      [value]="obras()"
      [lazy]="true"
      (onLazyLoad)="onLazyLoad($event)"
      [paginator]="true"
      [rows]="rows()"
      [totalRecords]="total()"
      [first]="first()"
      [loading]="loading()"
      dataKey="id"
    >
      <!-- [tableStyle]="{ 'min-width': '70rem', 'background': 'red'}" -->
      <!-- style="background: pink; border: 1px solid red; padding: 1rem;" -->
      <ng-template pTemplate="header">
        <tr>
          <th style="min-width:8rem;">Año</th>
          <th style="min-width:10rem;">Código</th>
          <th>Nombre</th>
          <th>Descripción</th>
          <th style="width:12rem;" class="text-center">Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-obra>
        <tr>
          <td>{{ obra.anio }}</td>
          <td>{{ obra.codmeta }}</td>
          <td>{{ obra.nombre || obra.nombre_corto || '—' }}</td>
          <td>
            <div style="max-height:76px; overflow:auto; line-height:1.3;">
              {{ obra.desmeta || '—' }}
            </div>
          </td>
          <td class="text-center">

          <!-- <p-button
            label="Importar usuarios"
            icon="pi pi-download"
            (onClick)="onImport(obra)">
          </p-button> -->

          <!-- class="custom-button"  -->
          <button 
            pButton 
            (click)="onImport(obra)"
          >
            <span pButtonLabel>Importar usuarios</span>
            <i class="pi pi-download" pButtonIcon></i>
          </button>

          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr><td colspan="5">No hay obras.</td></tr>
      </ng-template>
    </p-table>
  </div>
  <!-- </ng-template> -->
</div>


<!-- ------------------ modal para mostrar la lista de obras ------------------------- -->

<app-show-all-obras-modal
  [(isOpen)]="showAllObrasModal"
/>
<!-- (isOpenChange)="showAllObrasModal.set($event)" -->
  <!-- [isOpen]="showAllObrasModal()"
  (isOpenChange)="cerrarModal()" -->